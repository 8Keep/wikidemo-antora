<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Transparency Sorting :: jMonkeyEngine Documentation</title>
    <link rel="canonical" href="https://8keep.github.io/wikidemo-antora/jme/3.3/jme3/intermediate/transparency_sorting.html">
    <meta name="keywords" content="transparent, sorting, bucket, z-buffer, alpha">
    <meta name="generator" content="Antora 2.3.0">
    <link rel="stylesheet" href="../../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://8keep.github.io/wikidemo-antora">jMonkeyEngine Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jme" data-version="3.3">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../documentation.html">jMonkeyEngine</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Engine</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../documentation.html">Documentation</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../../jme3.html">jMonkeyEngine 3</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Beginner Tutorials</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../beginner/hello_simpleapplication.html">Hello SimpleApplication</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../beginner/hello_node.html">Hello Node</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../beginner/hello_asset.html">Hello Asset</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../beginner/hello_main_event_loop.html">Hello Main Event Loop</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../beginner/hello_input_system.html">Hello Input System</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../beginner/hello_material.html">Hello Material</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../beginner/hello_animation.html">Hello Animation</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../beginner/hello_picking.html">Hello Picking</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../beginner/hello_collision.html">Hello Collision</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../beginner/hello_terrain.html">Hello Terrain</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../beginner/hello_audio.html">Hello Audio</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../beginner/hello_effects.html">Hello Effects</a>
  </li>
  <li class="nav-item" data-depth="3">
    <a class="nav-link" href="../beginner/hello_physics.html">Hello Physics</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="2">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Intermediate Tutorials</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Concepts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="best_practices.html">Best Practices</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="simpleapplication.html">Simple Application</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../features.html">Features</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="optimization.html">Optimization</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../faq.html">FAQ</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Math Concepts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../math_for_dummies.html">Math For Dummies</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="math.html">Math</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../math.html">More Math</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../rotate.html">Rotate</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../math_video_tutorials.html">Math Video Tutorials</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="3">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">3D Graphics Concepts</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="multi-media_asset_pipeline.html">Multi-Media Asset Pipeline</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../scenegraph_for_dummies.html">Scenegraph for Dummies</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../beginner/hellovector.html">Hello Vector</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../terminology.html">Terminology</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="how_to_use_materials.html">How to Use Materials</a>
  </li>
  <li class="nav-item is-current-page" data-depth="4">
    <a class="nav-link" href="transparency_sorting.html">Transparency and Sorting</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../external/blender.html">Importing from Blender</a>
  </li>
  <li class="nav-item" data-depth="4">
    <a class="nav-link" href="../external/3dsmax.html">Importing from 3DS Max</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../logo.html">Logo Usage</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../bsd_license.html">License</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../github_tips.html">Github Tips</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../sdk.html">jMonkeyEngine SDK</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">jMonkeyEngine</span>
    <span class="version">3.3</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">jMonkeyEngine</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../documentation.html">3.3</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../documentation.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../documentation.html">jMonkeyEngine</a></li>
    <li>Engine</li>
    <li><a href="../../jme3.html">jMonkeyEngine 3</a></li>
    <li>Intermediate Tutorials</li>
    <li>3D Graphics Concepts</li>
    <li><a href="transparency_sorting.html">Transparency and Sorting</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="https://github.com/8Keep/wikidemo-antora/edit/master/docs/modules/ROOT/pages/jme3/intermediate/transparency_sorting.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<article class="doc">
<h1 class="page">Transparency Sorting</h1>
<div class="paragraph">
<p>There is often a lot of confusion with how pixels get processed in relation to the z-buffer and why sorting is important.  Most importantly it can be mind-warping trying to wrap one&#8217;s head around how to 'fix' the cases where proper sorting isn&#8217;t possible.</p>
</div>
<div class="paragraph">
<p>Hopefully these diagrams help show the futility of it all… I mean the trade offs one has to make to get transparency looking its best in the general case.</p>
</div>
<div class="paragraph">
<p>The first image I&#8217;ll show is the 'best case' where all objects are drawn back to front.  I&#8217;ll then discuss briefly the steps JME goes through to try to make that happen.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../../_images/jme3/intermediate/transparency_sorting1.png" alt="transparency_sorting1.png" width="600" height="">
</div>
</div>
<div class="paragraph">
<p>In JME, the opaque layer would generally be placed in the opaque bucket.  All opaque layers are drawn first and within the ability to sort them, they are sorted front to back to prevent overdraw.</p>
</div>
<div class="paragraph">
<p>After the opaque bucket is drawn, the transparent bucket is drawn and it is sorted back to front.  So in the ideal case it would appear exactly as in this picture.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Sorting is done at the object level and it can never be perfect.  It is impossible to properly sort objects by distance in the general case even if they were just triangles.  Simply imagine intersecting triangles and it&#8217;s clear there is no proper order.  JME tries its best.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next I&#8217;ll show an image of the worst case scenario to show why sorting is important and how your 'best friend' the z-buffer is really transparency&#8217;s worst enemy.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../../_images/jme3/intermediate/transparency_sorting2.png" alt="transparency_sorting2.png" width="600" height="">
</div>
</div>
<div class="paragraph">
<p>This is what will happen if you put all of your objects in the opaque buffer.  JME will sort them front to back and you will get these strange 'windows' into your background.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Because sorting is done at the object level, you may have triangle to triangle overlap even within the same mesh if it is non-convex.  Think of a glass donut where the near surface triangles are drawn before the hole&#8217;s triangles.  There will be this same issue where they occlude the farther triangles.  A different angle on the donut might produce the correct results depending on the order of the triangles in the mesh.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Finally, I&#8217;ll augment the worst case sorting with something like <code>alphaDiscardThreshold</code> (or the old alphaTest/alphaFalloff values).  In this example, let&#8217;s pretend we only discard pixels with alpha = 0.</p>
</div>
<div class="imageblock text-center">
<div class="content">
<img src="../../_images/jme3/intermediate/transparency_sorting3.png" alt="transparency_sorting3.png" width="600" height="">
</div>
</div>
<div class="paragraph">
<p>It&#8217;s better but not perfect.  Any partially transparent pixels will still show the issue.  Partial transparency will drive you crazy if you let it.</p>
</div>
<div class="paragraph">
<p>Bottom line:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>back to front sorting would fix all issues</p>
</li>
<li>
<p>accurate back to front sorting in the general case is impossible</p>
</li>
<li>
<p>for purely on/off a = 1 or a = 0 transparency then a discard threshold is the best bet to mitigate sorting problems.</p>
</li>
<li>
<p>Where 0 &lt; alpha &lt; 1, improper sorting of triangles/pixels will always cause artifacts.</p>
</li>
</ul>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
