<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3ds Max Bone Animation to JME3 using OgreMax plugin :: jMonkeyEngine Documentation</title>
    <link rel="canonical" href="https://8keep.github.io/wikidemo-antora/jme3/1/jme3/external/3dsmax.html">
    <meta name="generator" content="Antora 2.3.0">
    <link rel="stylesheet" href="../../../../_/css/site.css">
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://8keep.github.io/wikidemo-antora">jMonkeyEngine Documentation</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="#">Home</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Products</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Product A</a>
            <a class="navbar-item" href="#">Product B</a>
            <a class="navbar-item" href="#">Product C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Services</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Service A</a>
            <a class="navbar-item" href="#">Service B</a>
            <a class="navbar-item" href="#">Service C</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Resources</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="#">Resource A</a>
            <a class="navbar-item" href="#">Resource B</a>
            <a class="navbar-item" href="#">Resource C</a>
          </div>
        </div>
        <div class="navbar-item">
          <span class="control">
            <a class="button is-primary" href="#">Download</a>
          </span>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="jme3" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../../documentation.html">Test</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../../documentation.html">jMonkeyEngine 3</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Test</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Test</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../documentation.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../documentation.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../../documentation.html">Test</a></li>
    <li><a href="3dsmax.html">3ds Max Bone Animation to JME3 using OgreMax plugin</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///home/davisro/dev/wikidemo-antora/docs/modules/ROOT/pages/jme3/external/3dsmax.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">3ds Max Bone Animation to JME3 using OgreMax plugin</h1>
<div class="sect1">
<h2 id="_asset_management"><a class="anchor" href="#_asset_management"></a>Asset Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For the managing of assets in general, be sure to read the <a href="../intermediate/multi-media_asset_pipeline.html" class="page">Asset Pipeline Documentation</a>. It contains vital information on how to manage your asset files.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_creating_models_in_3dsmax"><a class="anchor" href="#_creating_models_in_3dsmax"></a>Creating models in 3dsMax</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For this tutorial I used 3D Studio Max 2012 and OgreMax 2.4.3 free edition</p>
</div>
<div class="sect2">
<h3 id="_create_model_and_bones"><a class="anchor" href="#_create_model_and_bones"></a>Create Model and Bones</h3>
<div class="ulist">
<ul>
<li>
<p>Create a new file</p>
</li>
<li>
<p>Select the “Create” tab &gt; “Geometry” &gt; “Cylinder”</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax-0.png" alt="3dsmax-0.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Draw a cylinder, lets say with 8 height segments (must be enough for a smooth deformation)</p>
</li>
<li>
<p>Also check “Generate Mapping Coords.”</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax-1.png" alt="3dsmax-1.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click “Create” tab &gt; “Systems” &gt; “Bones”</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax-2.png" alt="3dsmax-2.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add some bones in the center of the cylinder</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax-3.png" alt="3dsmax-3.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Select the cylinder, right click it and click “Convert To:” &gt; “Convert to Editable Mesh” to prevent issues with OgreMax</p>
</li>
<li>
<p>Click the “Modify” tab &gt; “Modifier List” and add the “Skin” modifier</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax-4.png" alt="3dsmax-4.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Beneath “Bones:” click “Add” and select all of your bones</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax-5.png" alt="3dsmax-5.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>You may also edit the envelopes, but for a small test the default settings are ok</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_create_the_animation"><a class="anchor" href="#_create_the_animation"></a>Create the animation</h3>
<div class="ulist">
<ul>
<li>
<p>Select the cylinder, and click “Display” tab &gt; “Freeze Selected” so it is easier to select the bones during animation</p>
</li>
<li>
<p>Select the two top bones and enable the “Auto Key” mode</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax-6.png" alt="3dsmax-6.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>The first key frame will be created automatically. Move the animation track slider to frame 5</p>
</li>
<li>
<p>Move the selected bones a bit. The cylinder mesh will be deformed. Because you are in the “Auto Key” mode, a key frame will be created</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax-7.png" alt="3dsmax-7.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create some additional key frames. You may also select more bones and move or rotate them. I’ve created 25 frames and the last key frame equals the first, so the animation is loopable</p>
</li>
<li>
<p>After creating the animation, disable the “Auto Key” mode</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_ogremax_settings"><a class="anchor" href="#_ogremax_settings"></a>OgreMax settings</h3>
<div class="ulist">
<ul>
<li>
<p>Open the “OgreMax Scene Settings” dialog from the menu</p>
</li>
<li>
<p>In the “Meshes” tab, enable “Export XML Files” and disable “Export Binary Files” as well as “Export Vertex Colors”</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax-8.png" alt="3dsmax-8.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Click the “Environment” tab and uncheck “Export Environment Settings”. Otherwise the JME importer will throw a NullPointerException</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax-9.png" alt="3dsmax-9.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you have textured your model, you may also check “Copy Bitmaps to Export Directory” in the “Bitmaps” tab</p>
</li>
<li>
<p>Unfreeze the cylinder by clicking “Display” tab &gt; “Unfreeze All” and select it</p>
</li>
<li>
<p>While having the cylinder selected, open the “OgreMax Object Settings” dialog from the menu</p>
</li>
<li>
<p>Open the “Mesh Animations” tab and select type “Skeleton”, “Export Skeleton” : “Yes”</p>
</li>
<li>
<p>Below “Mesh Animations” hit the “Add…” button</p>
</li>
<li>
<p>Assign a name to the track, maybe “wobble”. The track type must be “Skin. Set the right “Start/End Frames” for your animation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax-10.png" alt="3dsmax-10.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Hit ok and you will see the animation in the table. You may add additional animations by selecting other frame ranges, if desired</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax-11.png" alt="3dsmax-11.png" width="" height=""></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_export_and_import"><a class="anchor" href="#_export_and_import"></a>Export and Import</h3>
<div class="ulist">
<ul>
<li>
<p>When all animations are in the list, select “OgreMax” &gt; “Export” &gt; “Export Scene” and name the file “worm.scene”</p>
</li>
<li>
<p>Create a JME test class that imports the file, get the animation controller and start the “wobble” animation</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.jme3.animation.AnimChannel;
import com.jme3.animation.AnimControl;
import com.jme3.animation.Skeleton;
import com.jme3.app.SimpleApplication;
import com.jme3.asset.plugins.FileLocator;
import com.jme3.light.AmbientLight;
import com.jme3.light.PointLight;
import com.jme3.material.Material;
import com.jme3.math.ColorRGBA;
import com.jme3.scene.Geometry;
import com.jme3.scene.Node;
import com.jme3.scene.Spatial;
import com.jme3.scene.control.LodControl;
import com.jme3.scene.debug.SkeletonDebugger;

/**
 * This is a test class for loading a Ogre XML scene exported by OgreMax.
 *
 * @author Stephan Dreyer
 *
 */
public class TestOgreMaxImport extends SimpleApplication {

  @Override
  public void simpleInitApp() {
    assetManager.registerLocator("Assets/model/ogre/test/", FileLocator.class);

    // create the geometry and attach it
    final Node model = (Node) assetManager.loadModel("worm.scene");
    // resize it, because of the large 3dsmax scales
    model.setLocalScale(.001f);

    // attach to root node
    rootNode.attachChild(model);
    addLodControl(model);

    final AnimControl ac = findAnimControl(model);

    try {
      // add a skeleton debugger to make bones visible
      final Skeleton skel = ac.getSkeleton();
      final SkeletonDebugger skeletonDebug = new SkeletonDebugger("skeleton",
          skel);
      final Material mat = new Material(assetManager,
          "Common/MatDefs/Misc/Unshaded.j3md");
      mat.setColor("Color", ColorRGBA.Green);
      mat.getAdditionalRenderState().setDepthTest(false);
      skeletonDebug.setMaterial(mat);
      ((Node) ac.getSpatial()).attachChild(skeletonDebug);

      // create a channel and start the wobble animation
      final AnimChannel channel = ac.createChannel();
      channel.setAnim("wobble");
    } catch (final Exception e) {
      e.printStackTrace();
    }

    // add some lights
    rootNode.addLight(new AmbientLight());
    rootNode.addLight(new PointLight());
  }

  public void addLodControl(final Spatial parent) {
    if (parent instanceof Node) {
      for (final Spatial s : ((Node) parent).getChildren()) {
        addLodControl(s);
      }
    } else if (parent instanceof Geometry) {
      final LodControl lc = new LodControl();
      lc.setDistTolerance(1f);
      parent.addControl(lc);
    }
  }

  /**
   * Method to find the animation control, because it is not on the models root
   * node.
   *
   * @param parent
   *          The spatial to search.
   * @return The {@link AnimControl} or null if it does not exist.
   */
  public AnimControl findAnimControl(final Spatial parent) {
    final AnimControl animControl = parent.getControl(AnimControl.class);
    if (animControl != null) {
      return animControl;
    }

    if (parent instanceof Node) {
      for (final Spatial s : ((Node) parent).getChildren()) {
        final AnimControl animControl2 = findAnimControl(s);
        if (animControl2 != null) {
          return animControl2;
        }
      }
    }

    return null;
  }

  public static void main(final String[] args) {
    new TestOgreMaxImport().start();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see your worms strange movements. Have fun!</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax-12.png" alt="3dsmax-12.png" width="" height=""></span></p>
</div>
<div class="sect3">
<h4 id="_3ds_max_biped_animation_to_jme3"><a class="anchor" href="#_3ds_max_biped_animation_to_jme3"></a>3ds Max Biped Animation to JME3</h4>
<div class="paragraph">
<p>You can also use the biped operator to animate models, but you have to consider a lot of things.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_character_in_3dsmax"><a class="anchor" href="#_creating_a_character_in_3dsmax"></a>Creating a character in 3dsMax</h3>
<div class="paragraph">
<p>I will not tell you in detail how to model a character. There I many good tutorials on the web, I used <a href="http://majoh.deviantart.com/art/Mandi-s-3dsmax-Biped-Tutorial-26515784">that one</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>You may create a biped before you start modeling, so it is quite easier to fit the proportions of the biped.</p>
</li>
<li>
<p>After creating a model and a biped I got something like that:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/1.png" alt="1.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>I added the “Meshmooth modifier with 2 iterations and got this result:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax_biped_2.png" alt="3dsmax_biped_2.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>After smoothing your mesh you could correct vertices with the “Edit Mesh modifier. Finally you add the “Physique modifier.</p>
</li>
<li>
<p>Now you can edit your envelopes to fit your model.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_creating_a_simple_walk_animation"><a class="anchor" href="#_creating_a_simple_walk_animation"></a>Creating a simple walk animation</h3>
<div class="ulist">
<ul>
<li>
<p>Select the chest of your biped, choose “Motion (1) tab &gt; “Foot Step Mode (2) &gt; “Create Multiple Footsteps (3)</p>
</li>
<li>
<p>You need to select the “In Place Mode (4), so the character moves in place without changing its location.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax_biped_3_1.png" alt="3dsmax_biped_3_1.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>You can now play a bit with the settings, I adjusted “Actual Stride Length and “Actual Stride Height.</p>
</li>
<li>
<p>For the “Number of Footsteps 6 will be sufficient because the animation is cycled later.</p>
</li>
<li>
<p><strong>Note:</strong> You can also create or edit footsteps by hand and move or rotate them.</p>
</li>
<li>
<p>After all footsteps are created, hit the “Create Keys for Inactive Footsteps button in the “Footstep Operations panel</p>
</li>
<li>
<p>You can now check your animation by pressing the “Play button in the timeline.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_preparing_the_export_and_setting_up_ogremax"><a class="anchor" href="#_preparing_the_export_and_setting_up_ogremax"></a>Preparing the export and setting up OgreMax</h3>
<div class="ulist">
<ul>
<li>
<p>The “OgreMax Scene Settings should be the same as shown above.</p>
</li>
<li>
<p>Because you want your animation to be looped, you&#8217;ve got to find two key frames where the legs are nearly in the same position. For my settings I&#8217;ve chosen the frames 48-78 for the walk animation.</p>
</li>
<li>
<p>Select the character mesh and open the “OgreMax Scene Settings dialog.</p>
</li>
<li>
<p>Open the “Mesh Animations” tab and select type “Skeleton”, “Export Skeleton” : “Yes”</p>
</li>
<li>
<p>Below “Mesh Animations” hit the “Add…” button</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax_biped_4.png" alt="3dsmax_biped_4.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Enter a name for the track, e.g. “walk.</p>
</li>
<li>
<p>Assure the track type is set to “Physique.</p>
</li>
<li>
<p>Set the start and end frames, for me it is 48-78.</p>
</li>
<li>
<p>Close the dialog by pushing “Ok.</p>
</li>
<li>
<p><strong>Note:</strong> It could be useful to create also a track “start_run, that blends between the stand and walk animation. I would use frame 0-47 for that.</p>
</li>
<li>
<p>Because you have a smooth model with a lot of polygons, it may be useful to create <a href="../advanced/mesh.html" class="page">levels of detail (LOD)</a>. When the camera is farther away, a low-poly mesh of your character will be rendered.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax_biped_5.png" alt="3dsmax_biped_5.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Open the “Mesh LOD tab in object settings.</p>
</li>
<li>
<p>It will suffice to select the “Automatic setting, but if your animation starts to look weird, you can create them by hand.</p>
</li>
<li>
<p>I used 4 levels of LOD with a distance of 1. Don&#8217;t worry about the distance setting, you can change it later in JME.</p>
</li>
<li>
<p>For the level reduction, I used 20 percent, which produce good results. You may adjust all the settings depending on your needs.</p>
</li>
<li>
<p>Close the dialoque by clicking “Ok.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_fixing_the_location"><a class="anchor" href="#_fixing_the_location"></a>Fixing the location</h3>
<div class="ulist">
<ul>
<li>
<p>Before you export you need to do a little fix, because your model is not really located where you see it. JME will get into a lot of trouble, if you don&#8217;t change that.</p>
</li>
<li>
<p>Assure to save the max file. Sometimes OgreMax crashes the whole application during export. If you want to change the animation after export, you should reload this file because fixing the location changes something I can&#8217;t really figure out.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax_biped_6.png" alt="3dsmax_biped_6.png" width="" height=""></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Right click the “Select and Move tool in the upper toolbar. A dialog will pop up.</p>
</li>
<li>
<p>Set the X and Y location to 0 and close the dialog.</p>
</li>
<li>
<p>There is another way to achieve this. If you have scaled, moved or rotated your model, just open the “Hierarchy tab and click “Transform and “Scale on the “Reset panel.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_export_and_import_2"><a class="anchor" href="#_export_and_import_2"></a>Export and Import</h3>
<div class="ulist">
<ul>
<li>
<p>Now you can export your scene. Select only the mesh and use “Export selected objects. You will not need the whole scene including the biped object, but the bones are created automatically during export.</p>
</li>
<li>
<p>Create a JME test class for the scene import.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For that, I extended the first class:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-java hljs" data-lang="java">import com.jme3.animation.AnimChannel;
import com.jme3.animation.AnimControl;
import com.jme3.animation.Skeleton;
import com.jme3.app.SimpleApplication;
import com.jme3.asset.plugins.FileLocator;
import com.jme3.light.AmbientLight;
import com.jme3.light.PointLight;
import com.jme3.material.Material;
import com.jme3.math.ColorRGBA;
import com.jme3.math.Vector3f;
import com.jme3.scene.Geometry;
import com.jme3.scene.Node;
import com.jme3.scene.Spatial;
import com.jme3.scene.control.LodControl;
import com.jme3.scene.debug.SkeletonDebugger;
import com.jme3.scene.shape.Box;

/**
 * This is a test class for loading a Ogre XML scene exported by OgreMax.
 *
 * @author Stephan Dreyer
 *
 */
public class TestOgreMaxImport extends SimpleApplication {

  @Override
  public void simpleInitApp() {
    assetManager.registerLocator("Assets/model/ogre/test/", FileLocator.class);

    // create the geometry and attach it
    final Node model = (Node) assetManager.loadModel("guy.scene");
    // resize it, because of the large 3dsmax scales
    model.setLocalScale(.02f);

    // attach to root node
    rootNode.attachChild(model);
    addLodControl(model);

    final AnimControl ac = findAnimControl(model);

    try {
      // add a skeleton debugger to make bones visible
      final Skeleton skel = ac.getSkeleton();
      final SkeletonDebugger skeletonDebug = new SkeletonDebugger("skeleton",
          skel);
      final Material mat = new Material(assetManager,
          "Common/MatDefs/Misc/Unshaded.j3md");
      mat.setColor("Color", ColorRGBA.Green);
      mat.getAdditionalRenderState().setDepthTest(false);
      skeletonDebug.setMaterial(mat);
      ((Node) ac.getSpatial()).attachChild(skeletonDebug);

      // create a channel and start the walk animation
      final AnimChannel channel = ac.createChannel();
      channel.setAnim("walk");
    } catch (final Exception e) {
      e.printStackTrace();
    }

    flyCam.setMoveSpeed(40f);
    cam.setLocation(new Vector3f(15, 10, 15));
    cam.lookAt(Vector3f.ZERO, Vector3f.UNIT_Y);
    cam.setFrustumNear(1f);

    // add some lights
    rootNode.addLight(new AmbientLight());

    final PointLight pl = new PointLight();
    pl.setPosition(new Vector3f(-3f, 3f, 1f));
    rootNode.addLight(pl);

    // add a box as floor
    final Box b = new Box(100f, 0.1f, 100f);
    final Geometry geo = new Geometry("floor", b);

    final Material mat = new Material(assetManager,
        "Common/MatDefs/Misc/Unshaded.j3md");
    mat.setColor("Color", ColorRGBA.LightGray);
    geo.setMaterial(mat);

    rootNode.attachChild(geo);
  }

  /**
   * Method to traverse through the scene graph and add a {@link LodControl} to
   * the mesh.
   *
   * @param parent
   *          The Node to add the control to.
   */
  public void addLodControl(final Spatial parent) {
    if (parent instanceof Node) {
      for (final Spatial s : ((Node) parent).getChildren()) {
        addLodControl(s);
      }
    } else if (parent instanceof Geometry) {
      final LodControl lc = new LodControl();

      // the distance for LOD changes is set here, you may adjust this
      lc.setDistTolerance(1f);
      parent.addControl(lc);
    }
  }

  /**
   * Method to find the animation control, because it is not on the models root
   * node.
   *
   * @param parent
   *          The spatial to search.
   * @return The {@link AnimControl} or null if it does not exist.
   */
  public AnimControl findAnimControl(final Spatial parent) {
    final AnimControl animControl = parent.getControl(AnimControl.class);
    if (animControl != null) {
      return animControl;
    }

    if (parent instanceof Node) {
      for (final Spatial s : ((Node) parent).getChildren()) {
        final AnimControl animControl2 = findAnimControl(s);
        if (animControl2 != null) {
          return animControl2;
        }
      }
    }

    return null;
  }

  public static void main(final String[] args) {
    new TestOgreMaxImport().start();
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>After starting the class, you can see a nice smooth walk animation (if it&#8217;s not smooth, you need to adjust your track frames):</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax_biped_7.png" alt="3dsmax_biped_7.png" width="" height=""></span></p>
</div>
<div class="paragraph">
<p>As you can see, the LOD is working:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../_images/jme3/external/3dsmax_biped_8.png" alt="3dsmax_biped_8.png" width="" height=""></span></p>
</div>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script async src="../../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
